## [STEP05] 김성인 - e-commerce


### PR 설명

- 결제 기능 작성
    - [[8c9ec6f]](https://github.com/HangHae-Study/e-commerce-/commit/8c9ec6fe7be3de6f48485c2434ed8fe353ee0762) - 결제 API 기능 작성 및 관련 도메인 코드 추가 반영
- ReadMe 파일 
    
---

### 리뷰 포인트
1. PaymentFacade 파일에, 
   - 주문 요청 -> 재고 확인 -> 잔고 확인 -> 재고 감소 -> 잔고감소 -> 결제 데이터 생성
   - 이라는 단계를 수행하도록.. 코드를 작성하였는데 (시간이 부족해서 급하게,,)
   - 이 클래스는 제가 봐도 너무 못 짠 것 같습니다.. (한 클래스안에 너무 많은 책임,, 도메인 간의 예외, 비즈니스 분리 실패한 것 같음)
   - 이번 과제에서는 프로젝트의 규모나, 명확하지 않은 이커머스 도메인에 대해 Fetch Join이나, 로우 쿼리(조인을 겸비한) 코드를 작성하는게 더 효율적이었을 것 같습니다.
   > - ***질문*** : 실무에서 만일에 단순 조회와 같은 기능에 N+1이 발생할 수 있는 도메인 기반의 (도메인간 데이터 조합을 위한) 쿼리를 여러 번 날리는 유즈케이스가 있으신가요?

2. 추후 동시성 문제 관련
   - "락" 이라는 어떤 데이터 접근에 대한 행위를 프록시 패턴으로 구사하고,
   - service 호출 시에 해당 프록시 패턴 내부에서 락이라는 행위를 추상화한 후에 비즈니스 로직이 수행되는 형태로 구조를 한번 짜보려고합니다.
   - 분산락 시에 Redis, Kafka 에 종속적이지 않는 코드를 짤 수 있다면 선택해볼만한 구조일 것 같은데,, 코치님 의견이 어떠신지 궁금합니다.
   > - ***질문*** : 자바에서 @Transactional 어노테이션에 의존하다 보니,, 들은 고민 입니다.
   >   - 예를 들어 Exception 발생 시, Rollback이 되며 감소되었던 재고가 롤백되어 재고 수량이 감소가 안된다.. 라는 생각은 비즈니스 로직이 절대 아닌 것처럼 느껴지고,
   >   - 그렇지 않다면, 헥사고날 아키텍처에서 여러 상품에 대한 재고 감소가 요청이 들어올 때, 실제로 DB에 감소 쿼리를 날리고 실패 시에 이를 restore하는 명령어를 통해 실패 하기 전에 성공한 재고 감소에 대해서 원복을 해야할 것 같은데,, 
   >   - 이 기준이 정말 모호한 것 같습니다. 
   >   - 메모리에서 재고감소를 날렸던 Id를 캐싱해뒀다가, 실패 시에 재호출을 하는가? 
   >   - 이런 부분에 대한 실무적인 해결방안이 있으신지 코치님의 견해 공유가 가능한지 여쭙고싶습니다 

---
### **핵심 체크리스트** :white_check_mark:

#### :one: 아키텍처 설계 (3개)
- [O] 선택한 아키텍처 패턴이 일관되게 적용되었는가?
- [O] 계층 간 의존성이 단방향으로 흐르는가? (순환참조 X)
- [O] README에 아키텍처 설명이 있는가?

#### :two: 핵심 구현 (3개)
- [O] 비즈니스 로직이 적절한 계층에 위치하는가?
- [O] 각 시나리오의 핵심 기능이 동작하는가?
- [O] 외부 기술(DB, HTTP)로부터 비즈니스 로직이 분리되었는가?

#### :three: 테스트 (2개)
- [O] 핵심 비즈니스 로직에 대한 단위 테스트가 있는가?
- [O] 테스트에서 Mock/Stub을 활용하여 의존성을 격리했는가?

---
### **구현 완료 기능** :pencil:

#### STEP05
- [O] **E-commerce**: 상품조회 + 주문/결제 + 포인트

#### STEP06
- [N] **E-commerce**: 선착순 쿠폰 + 재고 동시성 + 결제 실패 복구

---
### **간단 회고** (3줄 이내)
- **잘한 점**: Facade 클래스를 도입하여,,, 서비스 - 레포지토리 간의 계층은 확실히 분리하려고 노력함
- **어려운 점**: step06 실패..
- **다음 시도**: 다음주는 회식이 3일이나 껴있는데,,,더 열심히하도록 하겠슴다..